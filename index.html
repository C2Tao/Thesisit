<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <link rel="stylesheet" href="CSS/myCSS.css">
    <link rel="stylesheet" href="CSS/myCSS_hover.css">
     <link rel="stylesheet" href="CSS/myCSS_navbar.css">
    <style>

    .node circle {
      cursor: pointer;
      stroke: #51e6bc;
      stroke-width: 4px;
    }

    .node text {
      font: 10px sans-serif;
      pointer-events: none;
      fill: black;
      text-anchor: middle;
    }

    line.link {
      fill: none;
      stroke: #727272;
      stroke-width: 2px;
    }

    </style>
</head>
    
<body>
<!--<div class="ThesisIt_tittle">
    <span class="icons"><img src="ThesisIt2.png" alt="" ></span>
    <span>
        <input class="input_query"></input>
    </span>
    <span class="button_query"><a href="index6.html" style="text-decoration:none;color: #87896e;">Search
    </span>
</div>-->

<header class="banner_back">
    <div class="LogoCircle_out"></div>
    <div class="banner"><div class="banner_tittle">ThesisIt!</div>
        <div class="ud-search search-v4 ml15">
            <form id="searchbox" action="/index8.html">
                <input type="text" placeholder="Search for Keywords, Papers..." autocomplete="off" name="q"
                       class="search-input ui-autocomplete-input quick-search"
                       value=""/>
                <button type="submit" class="icon-search search-btn"><img src="img/toolbar_find.png"><a href="index8.html"></button>
            </form>
        </div>
        <div class="LogoCircle" ><div class="logoPic" ></div></div>
    </div>
</header>

<script src="D3JS/d3.min.js"></script>
 
    <script>

    var width = 1440,
        height =1000,
        root;

    var force = d3.layout.force()
        //.linkDistance(function(d){return (d.distance);})
        .charge(-250)
        .gravity(.01)
        .size([width, height])
        .on("tick", tick);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("class", "graph-svg-component");

    var link = svg.selectAll(".link"),
        node = svg.selectAll(".node");

    d3.json("JSON/graphTUI.json", function(error, json) {
      root = json;
      update();
    });

    function update() {
      var nodes = flatten(root),
          links = d3.layout.tree().links(nodes);
      // Restart the force layout.
      force
          .nodes(nodes)
          //.linkDistance(function(d){return (d.distance);})
          .linkDistance(function(d) { return d.target.distance*20; })
          .links(links)
          .start();

      // Update links.
      link = link.data(links, function(d) { return d.target.id; });

      link.exit().remove();

      link.enter().insert("line", ".node")
          .attr("class", "link");

      // Update nodes.
      node = node.data(nodes, function(d) { return d.id; });

      node.exit().remove();

      var nodeEnter = node.enter().append("g")
          //.attr("class", "node")
          .attr("class", function(d) { return "node type" + d.type })
          .on("click", click)
          .call(force.drag)
      
      nodeEnter.append("circle")
          .attr("r", function(d) { return 30; })
          .style("fill", color1)
          .on('mouseover', function() { d3.select(this).transition().duration(200).attr("r", 40)
  })
          
          .on('mouseout', function() { d3.select(this).transition().duration(500).attr("r", 30);
  });
      nodeEnter.append("text")
          .attr("dy", "2em")
          .text(function(d) { return d.name; });
      }
// paper with pics-------------------------------------------          
//          d3.selectAll(".type2").append("image")
//          .attr("xlink:href", function(d){return d.img_href})
//          .attr("opacity",.7)
//          .attr("x", -25)
//          .attr("y", -25)
//          .attr("width", 50)
//          .attr("height", 50)
//          .on('mouseover', function() { d3.select(this).transition().duration(200).attr("x", -40)
//          .attr("y", -40).attr("width", 80).attr("opacity",1)
//          .attr("height", 80);
//  })
//          
//          .on('mouseout', function() { d3.select(this).transition().duration(500).attr("x", -25)
//          .attr("y", -25).attr("width", 50).attr("opacity",.3)
//          .attr("height", 50);
//  }); 
// All circle-------------------------------------------
//          d3.selectAll(".type2").append("circle")
//          .attr("r", function(d) { return 20; })
//          
//          .on('mouseover', function() { d3.select(this).transition().duration(200).attr("r", 30)
//  })
//          
//          .on('mouseout', function() { d3.select(this).transition().duration(500).attr("r", 20);
//  })
//          .style("fill", color1);
//          
//          nodeEnter.append("text")
//          .attr("dy", "2em")
//          .text(function(d) { return d.name; });
//          
//          
//          d3.selectAll(".type1").append("circle")
//          .attr("r", function(d) { return 20; })
//          
//          .on('mouseover', function() { d3.select(this).transition().duration(200).attr("r", 30)
//  })
//          
//          .on('mouseout', function() { d3.select(this).transition().duration(500).attr("r", 20);
//  })
//          .style("fill", color1);
//          
//          nodeEnter.append("text")
//          .attr("dy", "2em")
//          .text(function(d) { return d.name; });
//      node.append("image")
//          .attr("xlink:href", function(d){return d.img_href})
//          .attr("x", -25)
//          .attr("y", -25)
//          .attr("width", 50)
//          .attr("height", 50);
          
//      node.select("circle")
//          //.attr("r", 20)
//          //.style("fill", color1);
//          .style("background", function(d){
//              if(d.type === 2){
//                  //console.log("url(#\""+d.img_href+"\")");
//                  return "url(#"+d.img_href+")";
//                   //return color1(d);
//              }
//              else{
//                  return color1(d);
//              }
//          });
    
    
    function tick() {
      link.attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

      node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

    }

//    function color(d) {
//      return d._children ? "#3182bd" // collapsed package
//          : d.children ? "#c6dbef" // expanded package
//          : "#fd8d3c"; // leaf node
//    }
    function color1(d) {
      if(d.type === 1){
          return "rgb(98, 206, 176)" ;
      }
      else if(d.type === 2){
          return "#fd8d3c";
      }
      else{
          return "rgb(255, 206, 12)" ;
      }
    }
    // Toggle children on click.
    function click(d) {
      if (d3.event.defaultPrevented) return; // ignore drag
        
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
      update();
    }

    // Returns a list of all nodes under the root.
    function flatten(root) {
      var nodes = [], i = 0;

      function recurse(node) {
        if (node.children) node.children.forEach(recurse);
        if (!node.id) node.id = ++i;
        nodes.push(node);
      }

      recurse(root);
      return nodes;
    }
    </script>
    
    <div class="bar-container">
			<div id='map-control' class="bar clear-float">
				<a class="view view-map on" href="/"><span></span>ThesisIt</a>
				<a class="view view-grid" href="/grid"><span></span>Grid</a>
				<div class="bar-section bar-section-view">
					<label>View:</label>
					<ul>
						<li><a href="#type=all" class="no-icon">All</a></li>
						<li><a href="#type=problem" class="problem"><span></span>Keywords</a></li>
						<li><a href="#type=interview" class="interview"><span></span>Papers</a></li>
<!--						<li><a href="#type=narrative" class="narrative"><span></span>Narrative</a></li>-->
					</ul>
				</div>
				<div class="bar-section bar-section-cat">
					<label>Category:</label>
					<div class="categories">
						<a class="menu all" href="#"><span></span>All<em></em></a>
						<ul class="clear-float"><li><a href="#category=simple" class="simple"><span></span>Simple</a></li><li><a href="#category=social" class="social"><span></span>Social</a></li><li><a href="#category=navigational" class="navigational"><span></span>Navigational</a></li><li><a href="#category=technological" class="technological"><span></span>Technological</a></li><li><a href="#category=transportational" class="transportational"><span></span>Transportational</a></li><li><a href="#category=repurposing" class="repurposing"><span></span>Repurposing</a></li><li><a href="#category=cultural" class="cultural"><span></span>Cultural</a></li><li><a href="#category=economic" class="economic"><span></span>Economic</a></li><li><a href="#category=experimental" class="experimental"><span></span>Experimental</a></li><li><a href="#category=all"><span></span>All</a></li></ul>
					</div>
				</div>
			</div>
    </div>
     <div class="logoCol">
			<h2 class="logo">ThesisIt</h2>
			<a class="about">paper search engine visualizer</a>
     </div>
</body>